const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/leaflet-src-BRINNIUY.js","assets/chunk-K6CSEXPM-DdwNiGzb.js","assets/index-B5IvplWm.js","assets/index-DPyoYoL2.js"])))=>i.map(i=>d[i]);
import{_ as D}from"./preload-helper-D7HrI6pR.js";import{w as G}from"./with-props-DbFBUsUC.js";import{r as a,p as $,l as t}from"./chunk-K6CSEXPM-DdwNiGzb.js";import{d as B,b as Y,s as H,T as L}from"./firebaseConfig-BRVrc43n.js";import{g as J}from"./index-e84cf44d-CdAT_r-a.js";const te=G(function(){const[i,x]=a.useState(""),[b,w]=a.useState(null),[g,v]=a.useState(""),[j,_]=a.useState(""),[A,o]=a.useState(""),[n,u]=a.useState(37.7749),[l,c]=a.useState(-122.4194),[p,P]=a.useState(null),[R,T]=a.useState(!1),[N,U]=a.useState(null),[S,F]=a.useState(null),[C,I]=a.useState(null),[E,O]=a.useState(null),[k,M]=a.useState(!1);$(),a.useEffect(()=>{typeof window<"u"&&Promise.all([D(()=>import("./leaflet-src-BRINNIUY.js").then(e=>e.l),__vite__mapDeps([0,1])),D(()=>import("./index-B5IvplWm.js"),__vite__mapDeps([2,1,0,3]))]).then(([e,r])=>{U(r.MapContainer),F(r.TileLayer),I(r.Marker),O(()=>r.useMapEvents),T(!0)}).catch(e=>console.error("Leaflet loading error:",e))},[]);const V=async e=>{const r=e.target.value;if(_(r),r.trim().length>3)try{const d=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(r)}&addressdetails=1&limit=1`)).json();if(d.length>0){const{lat:f,lon:m,display_name:y}=d[0];u(parseFloat(f)),c(parseFloat(m)),o(y),p&&p.setView([f,m],15)}}catch(s){console.error("Geocoding error:",s),o("Error occurred while geocoding address")}},h=async()=>{try{const r=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${n}&lon=${l}&addressdetails=1`)).json();r.display_name?o(r.display_name):o("Unknown location")}catch(e){console.error("Reverse geocoding error:",e)}};function q(){return!E||!C?null:(E({click(e){u(e.latlng.lat),c(e.latlng.lng),h(),p&&p.setView([e.latlng.lat,e.latlng.lng],15)}}),t.jsx(C,{position:{lat:n,lng:l}}))}const z=async()=>{const r=J().currentUser;if(!i.trim()||!b||!j.trim()){alert("Please fill all required fields.");return}if(!r){alert("You must be logged in to submit an ad.");return}M(!0);try{const s=new FormData;s.append("file",b),s.append("upload_preset","yp3oxvpp"),s.append("resource_type","video"),s.append("chunk_size","6000000");const d=await fetch("https://api.cloudinary.com/v1_1/dafdsqf6h/video/upload",{method:"POST",body:s});if(!d.ok)throw new Error("Failed to upload video to Cloudinary");const m=(await d.json()).secure_url,y=B(Y,"ads",i);await H(y,{companyName:i,adFileUrl:m,address:A,latitude:n,longitude:l,contractStatus:"active",expiryDate:g?L.fromDate(new Date(g)):null,createdAt:L.now(),userId:r.uid}),x(""),w(null),v(""),_(""),o(""),u(37.7749),c(-122.4194),alert("Ad successfully uploaded and fields cleared!")}catch(s){console.error("âŒ Error submitting ad:",s),alert("Error uploading ad. Please try again.")}M(!1)};return t.jsxs("div",{className:"bg-gray-100 min-h-screen p-5",children:[t.jsx("header",{className:"flex justify-center items-center bg-gray-900 text-white p-5 rounded-lg shadow-md",children:t.jsx("h1",{className:"text-2xl font-bold text-white",children:"Advertisement Management"})}),t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mt-5 border border-gray-300",children:[t.jsx("h3",{className:"text-lg font-semibold text-black mb-3",children:"Upload New Advertisement"}),t.jsx("input",{type:"text",placeholder:"Enter Company Name",value:i,onChange:e=>x(e.target.value),className:"w-full p-3 border border-gray-400 rounded mt-2 text-black"}),t.jsx("input",{type:"file",onChange:e=>w(e.target.files[0]),className:"w-full p-3 border border-gray-400 rounded mt-2 text-black"}),t.jsx("input",{type:"text",placeholder:"Enter Address",value:j,onChange:V,className:"w-full p-3 border border-gray-400 rounded mt-2 text-black"}),t.jsx("input",{type:"text",placeholder:"Geocoded Address (Auto-filled)",value:A,readOnly:!0,className:"w-full p-3 border border-gray-400 rounded mt-2 text-gray-500 bg-gray-200"}),t.jsxs("div",{className:"flex gap-3 mt-2",children:[t.jsx("input",{type:"text",placeholder:"Latitude",value:n,onChange:e=>u(e.target.value),onBlur:h,className:"w-full p-3 border border-gray-400 rounded text-black"}),t.jsx("input",{type:"text",placeholder:"Longitude",value:l,onChange:e=>c(e.target.value),onBlur:h,className:"w-full p-3 border border-gray-400 rounded text-black"})]}),t.jsx("input",{type:"date",value:g,onChange:e=>v(e.target.value),className:"w-full p-3 border border-gray-400 rounded mt-2 text-black"}),t.jsx("div",{className:"h-60 w-full mt-3",children:R&&N&&S&&t.jsxs(N,{center:{lat:n,lng:l},zoom:13,whenCreated:P,style:{height:"100%",width:"100%"},children:[t.jsx(S,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.jsx(q,{})]})}),t.jsx("button",{onClick:z,className:"w-full mt-4 bg-gradient-to-r from-blue-600 to-blue-500 text-white p-3 rounded shadow-md hover:brightness-110 transition",disabled:k,children:k?"Uploading...":"Submit Ad"})]})]})});export{te as default};
