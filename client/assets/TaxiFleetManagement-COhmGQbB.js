const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/leaflet-src-BRINNIUY.js","assets/chunk-K6CSEXPM-DdwNiGzb.js","assets/leaflet-CIGW-MKW.css","assets/index-B5IvplWm.js","assets/index-DPyoYoL2.js"])))=>i.map(i=>d[i]);
import{w as W}from"./with-props-DbFBUsUC.js";import{r as s,l as e,t as ee}from"./chunk-K6CSEXPM-DdwNiGzb.js";import{_ as R}from"./preload-helper-D7HrI6pR.js";import{h as te,o as b,c as C,b as U,d as B,u as se,i as ne,f as ae}from"./firebaseConfig-BRVrc43n.js";import{i as ie}from"./index-e84cf44d-CdAT_r-a.js";import{c as oe}from"./createLucideIcon-CD_6Kii1.js";import{M as ce}from"./map-pin-Dd6jWKqM.js";import{V as re}from"./video-DIHXuhe_.js";/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],le=oe("CircleCheckBig",de),pe={apiKey:"AIzaSyB8Ya_6k9m5dGgLXENkr3zcZCKviTqJsdI",authDomain:"tablet-service-d37a6.firebaseapp.com",projectId:"tablet-service-d37a6",storageBucket:"tablet-service-d37a6.firebasestorage.app",messagingSenderId:"641570257898",appId:"1:641570257898:web:f2564dd5fee33554a25093",measurementId:"G-PLD515GB9L"},me=ie(pe,"tabletApp"),A=te(me),ue=(l,p,o,j)=>{const r=(o-l)*Math.PI/180,n=(j-p)*Math.PI/180,a=Math.sin(r/2)*Math.sin(r/2)+Math.cos(l*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))*1e3},he=()=>{const[l,p]=s.useState(null),[o,j]=s.useState([]),[c,r]=s.useState([]),[n,a]=s.useState(null),[I,m]=s.useState(!1),[u,y]=s.useState(!1);if(s.useEffect(()=>{typeof window<"u"&&Promise.all([R(()=>import("./leaflet-src-BRINNIUY.js").then(t=>t.l),__vite__mapDeps([0,1])),R(()=>Promise.resolve({}),__vite__mapDeps([2])),R(()=>import("./index-B5IvplWm.js"),__vite__mapDeps([3,1,0,4]))]).then(([t,T,d])=>{const{MapContainer:f,TileLayer:k,Marker:N,Popup:_,Circle:L,useMap:E}=d,P=new t.Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/2087/2087658.png",iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[0,-40]}),M=new t.Icon({iconUrl:"https://unpkg.com/leaflet@1.6.0/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.6.0/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[0,-41]});p({MapContainer:f,TileLayer:k,Marker:N,Popup:_,Circle:L,MapUpdater:({position:x})=>{const g=E();return s.useEffect(()=>{x&&x.length&&g.flyTo(x,11,{animate:!0,duration:1.5})},[x,g]),null},carIcon:P,pinIcon:M,L:t})})},[]),s.useEffect(()=>{const t=b(C(U,"ads"),T=>{const d=T.docs.map(f=>({id:f.id,...f.data()}));j(d)});return()=>t()},[]),s.useEffect(()=>{const t=[];return(async()=>{const d=await b(C(A,"taxiCompany"),f=>{f.docs.forEach(k=>{const N=k.id,_=C(A,`taxiCompany/${N}/devices`),L=b(_,E=>{E.docs.map(async P=>{const M=P.id,S=`taxiCompany/${N}/devices/${M}/location`,x=B(A,`${S}/device_location`),g=B(A,`${S}/clients_data`),X=b(x,Y=>{const v=Y.data();v&&b(g,Z=>{const D=Z.data();if(D){const i=o.find(w=>ue(v.latitude,v.longitude,w.latitude,w.longitude)<=500),G=i?i.companyName:D.geofenceAreaName||"None";se(g,{geofenceAreaName:G}),r(w=>[...w.filter(Q=>Q.id!==M),{id:M,companyId:N,latitude:v.latitude,longitude:v.longitude,clientsDataRef:g,geofenceAreaName:G,geofenceTriggered:!!i,videoUrl:D.videoUrl||""}]),i&&!I?(m(!0),a({companyName:G,videoUrl:i.adUrl}),y(!1)):!i&&I&&u&&(m(!1),a(null)),i&&i.companyName!==(n==null?void 0:n.companyName)&&(a({companyName:i.companyName,videoUrl:i.adUrl}),y(!1))}})});t.push(X)})});t.push(L)})});t.push(d)})(),()=>t.forEach(d=>d())},[o,n,u]),!l)return e.jsx("p",{children:"Loading map..."});const{MapContainer:h,TileLayer:F,Marker:z,Popup:O,Circle:$,MapUpdater:q,carIcon:K,pinIcon:J}=l,V=c[0]?[c[0].latitude,c[0].longitude]:[14.5995,120.9842];return e.jsxs("div",{style:{width:"100%",height:"700px"},children:[e.jsxs(h,{center:V,zoom:11,style:{height:"650px",width:"100%"},children:[e.jsx(F,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"Â© OpenStreetMap contributors"}),e.jsx(q,{position:V}),c.map(t=>e.jsx(z,{position:[t.latitude,t.longitude],icon:K,children:e.jsxs(O,{children:[e.jsx("strong",{children:"Taxi ID:"})," ",t.id," ",e.jsx("br",{}),e.jsx("strong",{children:"Status:"})," ",t.geofenceTriggered?"Inside Geofence":"Outside Geofence"," ",e.jsx("br",{}),e.jsx("strong",{children:"Area:"})," ",t.geofenceAreaName||"None"," ",e.jsx("br",{}),"Lat: ",t.latitude," ",e.jsx("br",{}),"Lng: ",t.longitude]})},t.id)),o.map(t=>e.jsxs(ee.Fragment,{children:[e.jsx($,{center:[t.latitude,t.longitude],radius:t.radius||500,pathOptions:{color:"red",fillColor:"red",fillOpacity:.2}}),e.jsx(z,{position:[t.latitude,t.longitude],icon:J,children:e.jsxs(O,{children:[e.jsx("strong",{children:t.companyName}),e.jsx("br",{}),"Address: ",t.address,e.jsx("br",{}),"Status: ",t.contractStatus,e.jsx("br",{}),"Expiry: ",t.expiryDate?new Date(t.expiryDate.seconds*1e3).toLocaleString():"N/A"]})})]},t.id))]}),n&&e.jsx("div",{className:"ad-display",children:e.jsxs("h3",{children:["Currently Playing Ad: ",n.companyName]})})]})},ve=W(function(){const[p,o]=s.useState([]),[j,c]=s.useState(0);s.useEffect(()=>{const a=b(ne(U,"tabletDevice"),m=>{const u=m.docs.map(y=>{const h=y.data();return{id:y.id,driverName:h.driverName||"Unknown",assignedTablet:h.assignedTablet||"N/A",isOnline:h.isOnline||!1,pairedAt:h.pairedAt||null}});o(u)});return(async()=>{const m=C(U,"ads"),u=await ae(m);c(u.size)})(),()=>a()},[]);const r=p.filter(a=>a.isOnline===!0).length,n=r;return e.jsxs("div",{className:"bg-gray-100 min-h-screen p-5",children:[e.jsx("header",{className:"flex justify-center items-center bg-gray-900 text-white p-5 rounded-lg shadow-md",children:e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Taxi Fleet Management"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 mt-5",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-300 flex flex-col items-center hover:scale-105 transition",children:[e.jsx(le,{size:40,className:"text-green-500"}),e.jsx("h3",{className:"text-xl font-semibold text-black mt-3",children:"Online Taxis"}),e.jsx("p",{className:"text-3xl font-bold text-black",children:r})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-300 flex flex-col items-center hover:scale-105 transition",children:[e.jsx(ce,{size:40,className:"text-indigo-500"}),e.jsx("h3",{className:"text-xl font-semibold text-black mt-3",children:"Geofence Areas"}),e.jsx("p",{className:"text-3xl font-bold text-black",children:j})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-300 flex flex-col items-center hover:scale-105 transition",children:[e.jsx(re,{size:40,className:"text-blue-500"}),e.jsx("h3",{className:"text-xl font-semibold text-black mt-3",children:"Running Ads"}),e.jsx("p",{className:"text-3xl font-bold text-black",children:n})]})]}),e.jsxs("div",{className:"mt-10 bg-white p-6 rounded-lg shadow-md border border-gray-300",children:[e.jsx("h2",{className:"text-xl font-semibold text-black mb-4",children:"Real-time Location Tracking"}),e.jsx(he,{taxis:p})]})]})});export{ve as default};
